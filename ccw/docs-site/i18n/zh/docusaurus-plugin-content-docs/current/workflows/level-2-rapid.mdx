---
title: "层级 2: 快速工作流"
description: "轻量规划和漏洞诊断工作流 - 适用于单模块功能"
sidebar_position: 3
---

import Mermaid from '@theme/Mermaid';

# 层级 2: 快速工作流

**复杂度**: 低-中等 | **产物**: 内存/轻量文件 | **状态**: 会话作用域

Level 2 工作流提供轻量级规划或单次分析，支持快速迭代。它们专为需求相对明确、不需要完整会话持久化的任务而设计。

## 概述

<Mermaid
  chart={`
    flowchart TD
        Start([用户输入]) --> Select{选择工作流}

        Select -->|需求<br/>明确| LP[lite-plan]
        Select -->|漏洞修复| LF[lite-fix]
        Select -->|需要<br/>多CLI| MCP[multi-cli-plan]

        LP --> LE[lite-execute]
        LF --> LE
        MCP --> LE

        LE --> Test{需要<br/>测试?}
        Test -->|是| TFG[test-fix-gen]
        Test -->|否| Done([完成])
        TFG --> TCE[test-cycle-execute]
        TCE --> Done

        classDef startend fill:#c8e6c9,stroke:#388e3c
        classDef workflow fill:#e3f2fd,stroke:#1976d2
        classDef decision fill:#fff9c4,stroke:#f57c00
        classDef execute fill:#c5e1a5,stroke:#388e3c

        class Start,Done startend,Select,Test decision,LP,LF,MCP workflow,LE execute,TFG,TCE execute
  `}
/>

## 包含的工作流

| 工作流 | 用途 | 产物 | 执行方式 |
|----------|---------|-----------|-----------|
| `lite-plan` | 需求明确的开发 | memory://plan | -> `lite-execute` |
| `lite-fix` | 漏洞诊断与修复 | `.workflow/.lite-fix/` | -> `lite-execute` |
| `multi-cli-plan` | 多视角任务 | `.workflow/.multi-cli-plan/` | -> `lite-execute` |

### 共同特征

| 属性 | 值 |
|----------|-------|
| **复杂度** | 低-中等 |
| **状态** | 会话作用域 / 轻量持久化 |
| **执行** | 统一通过 `lite-execute` |
| **使用场景** | 需求相对明确 |

---

## 工作流 1: lite-plan -> lite-execute

**内存规划 + 直接执行**

### 命令

```bash
/workflow:lite-plan "Add user authentication API"
/workflow:lite-execute
```

### 流程图

<Mermaid
  chart={`
    flowchart TD
        A([开始]) --> B[阶段 1: 代码探索]
        B --> C{需要<br/>代码探索?}
        C -->|是| D[cli-explore-agent<br/>多角度分析]
        C -->|否| E[跳过探索]

        D --> F[阶段 2: 复杂度评估]
        E --> F

        F --> G{复杂度}
        G -->|低| H[直接 Claude<br/>规划]
        G -->|中| H
        G -->|高| I[cli-lite-planning<br/>-agent]

        H --> J[阶段 3: 规划]
        I --> J

        J --> K[阶段 4: 确认]
        K --> L{确认?}
        L -->|修改| M[调整计划]
        M --> K
        L -->|允许| N[阶段 5: 执行]
        L -->|取消| O([中止])

        N --> P[构建执行上下文]
        P --> Q[/workflow:lite-execute]
        Q --> R([完成])

        classDef startend fill:#c8e6c9,stroke:#388e3c
        classDef action fill:#e3f2fd,stroke:#1976d2
        classDef decision fill:#fff9c4,stroke:#f57c00
        classDef agent fill:#ffecb3,stroke:#ffa000

        class A,R,O startend,B,D,E,J,M,P,Q action,C,G,L decision,F,H,I agent
  `}
/>

### 流程阶段

**阶段 1: 代码探索** (可选)
```bash
# 如果指定了 -e 参数
/workflow:lite-plan -e "Add user authentication API"
```
- 通过 cli-explore-agent 进行多角度代码分析
- 识别模式、依赖关系、集成点

**阶段 2: 复杂度评估**
- 低: 无需代理，直接规划
- 中/高: 使用 cli-lite-planning-agent

**阶段 3: 规划**
- 加载计划 schema: `~/.claude/workflows/cli-templates/schemas/plan-json-schema.json`
- 按照生成计划 schema 生成 plan.json

**阶段 4: 确认与选择**
- 显示计划摘要（任务、复杂度、预估时间）
- 询问用户选择:
  - 确认: 允许 / 修改 / 取消
  - 执行: Agent / Codex / Auto
  - 审核: Gemini / Agent / 跳过

**阶段 5: 执行**
- 构建执行上下文（计划 + 探索 + 澄清 + 选择）
- 通过 `/workflow:lite-execute --in-memory` 执行

### 产物

- **内存**: `memory://plan` (不持久化)
- **可选**: `.workflow/.lite-exploration/` (如果使用了代码探索)

### 使用场景

需求明确的单模块功能

**示例**:
```bash
/workflow:lite-plan "Add email validation to user registration form"
/workflow:lite-execute
```

---

## 工作流 2: lite-fix

**智能诊断 + 修复 (5 阶段)**

### 命令

```bash
/workflow:lite-fix "Login timeout after 30 seconds"
/workflow:lite-execute --in-memory --mode bugfix

# 紧急热修复模式
/workflow:lite-fix --hotfix "Production database connection failing"
```

### 流程图

<Mermaid
  chart={`
    flowchart TD
        A([开始]) --> B[阶段 1: 漏洞分析<br/>& 诊断]
        B --> C[严重程度预评估<br/>低/中/高/严重]
        C --> D[并行 cli-explore<br/>-agent 诊断<br/>1-4 角度]

        D --> E[阶段 2: 澄清]
        E --> F{需要<br/>更多信息?}
        F -->|是| G[AskUserQuestion<br/>聚合澄清]
        F -->|否| H[阶段 3: 修复规划]
        G --> H

        H --> I{严重程度}
        I -->|低/中| J[直接 Claude<br/>规划]
        I -->|高/严重| K[cli-lite-planning<br/>-agent]

        J --> L[阶段 4: 确认]
        K --> L

        L --> M[用户确认<br/>执行方法]
        M --> N[阶段 5: 执行]
        N --> O[/workflow:lite-execute<br/>--in-memory --mode bugfix/]
        O --> P([完成])

        Q[热修复模式] --> R[跳过诊断<br/>最小规划]
        R --> N

        classDef startend fill:#c8e6c9,stroke:#388e3c
        classDef action fill:#e3f2fd,stroke:#1976d2
        classDef decision fill:#fff9c4,stroke:#f57c00
        classDef agent fill:#ffecb3,stroke:#ffa000
        classDef hotfix fill:#ffccbc,stroke:#bf360c

        class A,P startend,B,E,G,H,L,M,N,O action,F,I decision,C,D,J,K agent,Q,R hotfix
  `}
/>

### 流程阶段

**阶段 1: 漏洞分析与诊断**
- 智能严重程度预评估（低/中/高/严重）
- 并行 cli-explore-agent 诊断（1-4 角度）

**阶段 2: 澄清** (可选)
- 聚合澄清需求
- AskUserQuestion 获取缺失信息

**阶段 3: 修复规划**
- 低/中严重程度 -> 直接 Claude 规划
- 高/严重程度 -> cli-lite-planning-agent

**阶段 4: 确认与选择**
- 显示修复计划摘要
- 用户确认执行方法

**阶段 5: 执行**
- 通过 `/workflow:lite-execute --in-memory --mode bugfix` 执行

### 产物

**位置**: `.workflow/.lite-fix/{bug-slug}-{YYYY-MM-DD}/`

```
.workflow/.lite-fix/
└── login-timeout-fix-2025-02-03/
    ├── diagnosis-root-cause.json
    ├── diagnosis-impact.json
    ├── diagnosis-code-flow.json
    ├── diagnosis-similar.json
    ├── diagnoses-manifest.json
    ├── fix-plan.json
    └── README.md
```

### 严重程度级别

| 严重程度 | 描述 | 规划方法 |
|----------|-------------|-----------------|
| **低** | 简单修复，根因明确 | 直接 Claude（可选理由） |
| **中** | 中等复杂度，需调查 | 直接 Claude（含理由） |
| **高** | 复杂，影响多个组件 | cli-lite-planning-agent（完整 schema） |
| **严重** | 生产事故，紧急 | cli-lite-planning-agent + 热修复模式 |

### 热修复模式

```bash
/workflow:lite-fix --hotfix "Production API returning 500 errors"
```

**特点**:
- 跳过大部分诊断阶段
- 最小规划（直接执行）
- 自动生成后续任务用于完整修复 + 事后分析

### 使用场景

- 漏洞诊断
- 生产环境紧急情况
- 根因分析

---

## 工作流 3: multi-cli-plan -> lite-execute

**多CLI 协作分析 + 共识收敛**

### 命令

```bash
/workflow:multi-cli-plan "Compare Redis vs Memcached for caching"
/workflow:lite-execute
```

### 流程图

<Mermaid
  chart={`
    flowchart TD
        A([开始]) --> B[阶段 1: 上下文收集]
        B --> C[ACE 语义搜索<br/>构建上下文包]

        C --> D[阶段 2: 多CLI 讨论<br/>迭代]
        D --> E[cli-discuss-agent]
        E --> F[Gemini + Codex + Claude]

        F --> G{已收敛?}
        G -->|否| H[交叉验证<br/>综合解决方案]
        H --> D
        G -->|是| I[阶段 3: 展示选项]

        I --> J[展示解决方案<br/>及权衡]

        J --> K[阶段 4: 用户决策]
        K --> L[用户选择解决方案]

        L --> M[阶段 5: 计划生成]
        M --> N[cli-lite-planning<br/>-agent]
        N --> O[-> lite-execute]

        O --> P([完成])

        classDef startend fill:#c8e6c9,stroke:#388e3c
        classDef action fill:#e3f2fd,stroke:#1976d2
        classDef decision fill:#fff9c4,stroke:#f57c00
        classDef agent fill:#ffecb3,stroke:#ffa000

        class A,P startend,B,C,E,H,J,L,M,O action,G,K decision,F,N agent
  `}
/>

### 流程阶段

**阶段 1: 上下文收集**
- ACE 语义搜索
- 构建上下文包

**阶段 2: 多CLI 讨论** (迭代)
- cli-discuss-agent 执行 Gemini + Codex + Claude
- 交叉验证，综合解决方案
- 循环直至收敛或达到最大轮次

**阶段 3: 展示选项**
- 展示解决方案及权衡

**阶段 4: 用户决策**
- 用户选择解决方案

**阶段 5: 计划生成**
- cli-lite-planning-agent 生成计划
- -> lite-execute

### 产物

**位置**: `.workflow/.multi-cli-plan/{MCP-task-slug-date}/`

```
.workflow/.multi-cli-plan/
└── redis-vs-memcached-2025-02-03/
    ├── context-package.json
    ├── rounds/
    │   ├── round-1/
    │   │   ├── gemini-analysis.md
    │   │   ├── codex-analysis.md
    │   │   ├── claude-analysis.md
    │   │   └── synthesis.json
    │   ├── round-2/
    │   └── ...
    ├── selected-solution.json
    ├── IMPL_PLAN.md
    └── plan.json
```

### 与 lite-plan 对比

| 方面 | multi-cli-plan | lite-plan |
|--------|---------------|-----------|
| **上下文** | ACE 语义搜索 | 手动文件模式 |
| **分析** | 多CLI 交叉验证 | 单次规划 |
| **迭代** | 多轮至收敛 | 单轮 |
| **可信度** | 高（共识驱动） | 中（单视角） |
| **时间** | 较长（多轮） | 更快 |

### 使用场景

- 多视角分析
- 技术选型
- 方案对比
- 架构决策

---

## Level 2 对比表

| 方面 | lite-plan | lite-fix | multi-cli-plan |
|--------|-----------|----------|----------------|
| **用途** | 需求明确 | 漏洞诊断 | 多视角 |
| **规划** | 内存中 | 基于严重程度 | 共识驱动 |
| **产物** | memory://plan | .lite-fix/ | .multi-cli-plan/ |
| **代码探索** | 可选 (-e 参数) | 内置诊断 | ACE 搜索 |
| **多CLI** | 否 | 否 | 是 (Gemini/Codex/Claude) |
| **最适合** | 单模块功能 | 漏洞修复 | 技术决策 |

## 执行: lite-execute

所有 Level 2 工作流通过 `lite-execute` 执行:

```bash
/workflow:lite-execute --in-memory
```

### 执行流程

<Mermaid
  chart={`
    flowchart TD
        A([开始]) --> B[初始化追踪<br/>previousExecutionResults]
        B --> C[任务分组<br/>& 批量创建]

        C --> D[提取显式<br/>depends_on]
        D --> E[分组: 独立<br/>任务 -> 并行批次]
        E --> F[分组: 依赖<br/>任务 -> 顺序阶段]

        F --> G[创建 TodoWrite<br/>批次列表]
        G --> H[启动执行]

        H --> I[阶段 1: 所有独立<br/>任务 - 单批次]
        I --> J[阶段 2+: 依赖任务<br/>按依赖顺序]

        J --> K[追踪进度<br/>TodoWrite 更新]
        K --> L{需要<br/>代码审核?}
        L -->|是| M[审核流程]
        L -->|否| N([完成])
        M --> N

        classDef startend fill:#c8e6c9,stroke:#388e3c
        classDef action fill:#e3f2fd,stroke:#1976d2
        classDef decision fill:#fff9c4,stroke:#f57c00

        class A,N startend,B,D,E,F,G,I,J,K,M action,C,L decision
  `}
/>

### 特性

- **并行执行** 独立任务
- **顺序阶段** 依赖任务
- **进度追踪** 通过 TodoWrite
- **可选代码审核**

## 相关工作流

- [Level 1: 超轻量级](./level-1-ultra-lightweight.mdx) - 更简单的工作流
- [Level 3: 标准级](./level-3-standard.mdx) - 完整会话管理
- [Level 4: 头脑风暴](./level-4-brainstorm.mdx) - 多角色探索
- [常见问题](./faq.mdx) - 常见问题解答
