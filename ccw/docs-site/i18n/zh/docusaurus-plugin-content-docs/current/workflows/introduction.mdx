---
title: 工作流介绍
description: CCW 工作流全面概述 - 从急速执行到智能编排
sidebar_position: 1
---

import Mermaid from '@theme/Mermaid';

# 工作流介绍

CCW 提供两类工作流体系：**主干工作流** (Main Workflow) 和 **Issue 工作流** (Issue Workflow)，它们协同覆盖软件开发的完整生命周期。

## 工作流架构概览

<Mermaid
  chart={`
    graph TB
        subgraph Main["主干工作流 (5 个层级)"]
            L1["层级 1: 急速执行<br/>lite-lite-lite"]
            L2["层级 2: 轻量规划<br/>lite-plan, lite-fix, multi-cli-plan"]
            L3["层级 3: 标准规划<br/>plan, tdd-plan, test-fix-gen"]
            L4["层级 4: 头脑风暴<br/>brainstorm:auto-parallel"]
            L5["层级 5: 智能编排<br/>ccw-coordinator"]
            L1 --> L2 --> L3 --> L4 --> L5
        end

        subgraph Issue["Issue 工作流 (开发后维护)"]
            I1["阶段 1: 积累<br/>discover, new"]
            I2["阶段 2: 解决<br/>plan, queue, execute"]
            I1 --> I2
        end

        Main -.->|开发完成后| Issue

        classDef level1 fill:#e3f2fd,stroke:#1976d2
        classDef level2 fill:#bbdefb,stroke:#1976d2
        classDef level3 fill:#90caf9,stroke:#1976d2
        classDef level4 fill:#64b5f6,stroke:#1976d2
        classDef level5 fill:#42a5f5,stroke:#1976d2
        classDef issue fill:#fff3e0,stroke:#f57c00

        class L1 level1,L2 level2,L3 level3,L4 level4,L5 level5,I1,I2 issue
  `}
/>

## 主干工作流 vs Issue 工作流

| 维度 | 主干工作流 | Issue 工作流 |
|------|-------------------|----------------|
| **定位** | 主要开发周期 | 开发后的维护补充 |
| **时机** | 功能开发阶段 | 主干开发完成后 |
| **范围** | 完整功能实现 | 针对性修复/增强 |
| **并行策略** | 依赖分析 + Agent 并行 | Worktree 隔离 (可选) |
| **分支模型** | 在当前分支工作 | 可使用独立 worktree |

### 为什么主干工作流不自动使用 Worktree？

**依赖分析已解决并行问题**：

1. 规划阶段 (`/workflow:plan`) 执行依赖分析
2. 自动识别任务依赖和关键路径
3. 划分**并行组** (独立任务) 和**串行链** (依赖任务)
4. Agent 并行执行独立任务，无需文件系统隔离

<Mermaid
  chart={`
    graph TD
        subgraph Dependency["依赖分析"]
            A["任务 A"]
            B["任务 B"]
            C["任务 C"]
            D["任务 D"]

            A & B --> PG["并行组 1<br/>Agent 1"]
            C --> SC["串行链<br/>Agent 2"]
            D --> SC

            PG --> R["结果"]
            SC --> R
        end

        classDef pg fill:#c8e6c9,stroke:#388e3c
        classDef sc fill:#fff9c4,stroke:#f57c00

        class PG pg,SC sc
  `}
/>

### 为什么 Issue 工作流支持 Worktree？

Issue 工作流作为**补充机制**，场景不同：

1. 主干开发完成，已合并到 `main`
2. 发现需要修复的问题
3. 需要在不影响当前开发的情况下修复
4. Worktree 隔离让主分支保持稳定

<Mermaid
  chart={`
    graph LR
        Dev["开发"] --> Rel["发布"]
        Rel --> Issue["发现问题"]
        Issue --> Fix["Worktree 修复"]
        Fix --> Merge["合并回主干"]
        Merge --> NewDev["继续新功能"]
        NewDev -.-> Dev
  `}
/>

## 15 个工作流层级详解

### 层级 1: 急速执行
**复杂度**: 低 | **产物**: 无 | **状态**: 无状态

| 工作流 | 描述 |
|----------|-------------|
| `lite-lite-lite` | 超轻量直接执行，零开销 |

**适用于**: 快速修复、简单功能、配置调整

---

### 层级 2: 轻量规划
**复杂度**: 低-中 | **产物**: 内存/轻量文件 | **状态**: 会话内

| 工作流 | 描述 |
|----------|-------------|
| `lite-plan` | 内存规划，适用于明确需求 |
| `lite-fix` | 智能漏洞诊断和修复 |
| `multi-cli-plan` | 多 CLI 协作分析 |

**适用于**: 单模块功能、漏洞修复、技术选型

---

### 层级 2.5: 桥接工作流
**复杂度**: 低-中 | **用途**: 轻量到 Issue 工作流的过渡

| 工作流 | 描述 |
|----------|-------------|
| `rapid-to-issue` | 从快速规划桥接到 Issue 工作流 |

**适用于**: 将轻量规划转换为 Issue 跟踪

---

### 层级 3: 标准规划
**复杂度**: 中-高 | **产物**: 持久化会话文件 | **状态**: 完整会话管理

| 工作流 | 描述 |
|----------|-------------|
| `plan` | 复杂功能开发，5 个阶段 |
| `tdd-plan` | 测试驱动开发，Red-Green-Refactor |
| `test-fix-gen` | 测试修复生成，渐进式层级 |

**适用于**: 多模块改动、重构、TDD 开发

---

### With-File 工作流 (层级 3-4)
**复杂度**: 中-高 | **产物**: 文档化探索 | **多 CLI**: 支持

| 工作流 | 描述 | 层级 |
|----------|-------------|-------|
| `brainstorm-with-file` | 多视角创意构思 | 4 |
| `debug-with-file` | 假设驱动调试 | 3 |
| `analyze-with-file` | 协作分析 | 3 |

**适用于**: 需要多 CLI 协作的文档化探索

---

### 层级 4: 头脑风暴
**复杂度**: 高 | **产物**: 多角色分析文档 | **角色数**: 3-9

| 工作流 | 描述 |
|----------|-------------|
| `brainstorm:auto-parallel` | 多角色头脑风暴与综合 |

**适用于**: 新功能设计、架构重构、探索性需求

---

### 层级 5: 智能编排
**复杂度**: 所有层级 | **产物**: 完整状态持久化 | **自动化**: 完全自动

| 工作流 | 描述 |
|----------|-------------|
| `ccw-coordinator` | 自动分析并推荐命令链 |

**适用于**: 复杂多步骤工作流、不确定命令、端到端自动化

---

### Issue 工作流
**复杂度**: 可变 | **产物**: Issue 记录 | **隔离**: Worktree 可选

| 阶段 | 命令 |
|-------|----------|
| **积累** | `discover`, `discover-by-prompt`, `new` |
| **解决** | `plan --all-pending`, `queue`, `execute` |

**适用于**: 开发后 Issue 修复、维护主分支稳定性

## 选择合适的工作流

### 快速选择表

| 场景 | 推荐工作流 | 层级 |
|----------|---------------------|-------|
| 快速修复、配置调整 | `lite-lite-lite` | 1 |
| 明确的单模块功能 | `lite-plan -> lite-execute` | 2 |
| 漏洞诊断和修复 | `lite-fix` | 2 |
| 生产环境紧急修复 | `lite-fix --hotfix` | 2 |
| 技术选型、方案对比 | `multi-cli-plan -> lite-execute` | 2 |
| 多模块改动、重构 | `plan -> verify -> execute` | 3 |
| 测试驱动开发 | `tdd-plan -> execute -> tdd-verify` | 3 |
| 测试失败修复 | `test-fix-gen -> test-cycle-execute` | 3 |
| 新功能、架构设计 | `brainstorm:auto-parallel -> plan -> execute` | 4 |
| 复杂多步骤工作流、不确定命令 | `ccw-coordinator` | 5 |
| 开发后 Issue 修复 | Issue 工作流 | - |

### 决策流程图

<Mermaid
  chart={`
    flowchart TD
        Start([开始新任务]) --> Q0{开发后<br/>维护?}

        Q0 -->|是| IssueW["Issue 工作流<br/>discover -> plan -> queue -> execute"]
        Q0 -->|否| Q1{不确定使用<br/>哪些命令?}

        Q1 -->|是| L5["层级 5: ccw-coordinator<br/>自动分析并推荐"]
        Q1 -->|否| Q2{需求<br/>明确?}

        Q2 -->|不确定| L4["层级 4: brainstorm:auto-parallel<br/>多角色探索"]
        Q2 -->|明确| Q3{需要持久化<br/>会话?}

        Q3 -->|是| Q4{开发类型?}
        Q3 -->|否| Q5{需要多<br/>视角?}

        Q4 -->|标准| L3Std["层级 3: plan -> verify -> execute"]
        Q4 -->|TDD| L3TDD["层级 3: tdd-plan -> execute -> verify"]
        Q4 -->|测试修复| L3Test["层级 3: test-fix-gen -> test-cycle"]

        Q5 -->|是| L2Multi["层级 2: multi-cli-plan"]
        Q5 -->|否| Q6{漏洞修复?}

        Q6 -->|是| L2Fix["层级 2: lite-fix"]
        Q6 -->|否| Q7{需要规划?}

        Q7 -->|是| L2Plan["层级 2: lite-plan -> lite-execute"]
        Q7 -->|否| L1["层级 1: lite-lite-lite"]

        IssueW --> End([完成])
        L5 --> End
        L4 --> End
        L3Std --> End
        L3TDD --> End
        L3Test --> End
        L2Multi --> End
        L2Fix --> End
        L2Plan --> End
        L1 --> End

        classDef level1 fill:#e3f2fd,stroke:#1976d2
        classDef level2 fill:#bbdefb,stroke:#1976d2
        classDef level3 fill:#90caf9,stroke:#1976d2
        classDef level4 fill:#64b5f6,stroke:#1976d2
        classDef level5 fill:#42a5f5,stroke:#1976d2
        classDef issue fill:#fff3e0,stroke:#f57c00

        class L1 level1,L2Plan,L2Fix,L2Multi level2,L3Std,L3TDD,L3Test level3,L4 level4,L5 level5,IssueW issue
  `}
/>

### 复杂度指标

系统基于关键词自动评估复杂度：

| 权重 | 关键词 |
|--------|----------|
| +2 | refactor(重构), migrate(迁移), architect(架构), system(系统) |
| +2 | multiple(多个), across(跨), all(所有), entire(整个) |
| +1 | integrate(集成), api, database(数据库) |
| +1 | security(安全), performance(性能), scale(扩展) |

- **高复杂度** (&gt;=4): 自动选择层级 3-4
- **中等复杂度** (2-3): 自动选择层级 2
- **低复杂度** (&lt;2): 自动选择层级 1

## 最小执行单元

**定义**: 必须作为原子组一起执行以实现有意义的工作流里程碑的一组命令。

| 单元名称 | 命令 | 用途 |
|-----------|----------|---------|
| **快速实现** | lite-plan -> lite-execute | 轻量规划和执行 |
| **多 CLI 规划** | multi-cli-plan -> lite-execute | 多视角分析和执行 |
| **漏洞修复** | lite-fix -> lite-execute | 漏洞诊断和修复执行 |
| **验证式规划** | plan -> plan-verify -> execute | 带验证的规划和执行 |
| **TDD 规划** | tdd-plan -> execute | 测试驱动开发规划和执行 |
| **测试验证** | test-fix-gen -> test-cycle-execute | 生成测试任务并执行测试修复循环 |
| **代码审查** | review-session-cycle -> review-cycle-fix | 完整审查循环并应用修复 |

## 下一步

- [层级 1: 超轻量工作流](./level-1-ultra-lightweight.mdx) - 了解急速执行
- [层级 2: 快速工作流](./level-2-rapid.mdx) - 轻量规划和漏洞修复
- [层级 3: 标准工作流](./level-3-standard.mdx) - 完整规划和 TDD
- [层级 4: 头脑风暴工作流](./level-4-brainstorm.mdx) - 多角色探索
- [层级 5: 智能工作流](./level-5-intelligent.mdx) - 自动化编排
- [常见问题](./faq.mdx) - 常见问题和解答
