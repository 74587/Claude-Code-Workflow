---
title: 层级 4: 头脑风暴工作流
description: 多角色头脑风暴工作流 - 协作探索和创意生成
sidebar_position: 5
---

import Mermaid from '@theme/Mermaid';

# 层级 4: 头脑风暴工作流

**复杂度**: 高 | **产物**: 多角色分析文档 | **角色数**: 3-9 | **执行**: 阶段 1/3 串行，阶段 2 并行

层级 4 工作流提供完整的多角色头脑风暴，包含完整的规划和执行能力。专为探索性需求、不确定的实现方案以及多维度的权衡分析而设计。

## 概述

<Mermaid
  chart={`
    flowchart TD
        Start([用户输入]) --> BS[brainstorm:auto-parallel]
        BS --> P1[阶段 1: 交互式<br/>框架生成]
        P1 --> P2[阶段 2: 并行<br/>角色分析]
        P2 --> P3[阶段 3: 综合<br/>整合]

        P3 --> Plan{需要详细<br/>规划?}
        Plan -->|是| Verify[plan-verify]
        Plan -->|否| Execute[execute]
        Verify --> Execute

        Execute --> Review{需要评审?}
        Review -->|是| Rev[review-session-cycle]
        Review -->|否| Test{需要测试?}
        Rev --> RevFix[review-cycle-fix]
        RevFix --> Test

        Test -->|是| TFG[test-fix-gen]
        Test -->|否| Complete([session:complete])

        TFG --> TCE[test-cycle-execute]
        TCE --> Complete

        classDef startend fill:#c8e6c9,stroke:#388e3c
        classDef workflow fill:#e3f2fd,stroke:#1976d2
        classDef decision fill:#fff9c4,stroke:#f57c00
        classDef execute fill:#c5e1a5,stroke:#388e3c

        class Start,Complete startend,Plan,Review,Test decision,BS,Verify,Rev,RevFix,TFG,TCE workflow,P1,P2,P3,Execute execute
  `}
/>

## 包含的工作流: brainstorm:auto-parallel

**多角色头脑风暴 + 完整规划 + 执行**

### 命令

```bash
/workflow:brainstorm:auto-parallel "实时通知系统架构设计" [--count N] [--style-skill package]
/workflow:plan --session {sessionId}
/workflow:plan-verify
/workflow:execute
```

### 流程图

<Mermaid
  chart={`
    flowchart TD
        A([开始]) --> B[阶段 1: 交互式<br/>框架生成]
        B --> C[/workflow:brainstorm:artifacts/]

        C --> D[主题分析<br/>生成问题]
        D --> E[角色选择<br/>用户确认]
        E --> F[角色问题收集]
        F --> G[冲突检测<br/>与解决]
        G --> H[生成 guidance-<br/>specification.md]

        H --> I[阶段 2: 并行角色分析]

        I --> J1[N 个 Task<br/>conceptual-planning-<br/>agent]
        J1 --> K1{角色 1}
        J1 --> K2{角色 2}
        J1 --> K3{角色 3}
        J1 --> K4{角色 N}

        K1 --> L1[独立分析]
        K2 --> L2[独立分析]
        K3 --> L3[独立分析]
        K4 --> L4[独立分析]

        L1 --> M[并行生成<br/>{role}/analysis.md]
        L2 --> M
        L3 --> M
        L4 --> M

        M --> N[阶段 3: 综合整合]
        N --> O[/workflow:brainstorm:<br/>synthesis/]
        O --> P[整合所有角色<br/>分析]
        P --> Q[综合为<br/>synthesis-specification.md]

        Q --> R([头脑风暴完成])

        classDef startend fill:#c8e6c9,stroke:#388e3c
        classDef action fill:#e3f2fd,stroke:#1976d2
        classDef phase fill:#fff9c4,stroke:#f57c00
        classDef parallel fill:#ffecb3,stroke:#ffa000

        class A,R startend,B,C,H,N,O,P,Q action,D,E,F,G,J1,K1,K2,K3,K4,L1,L2,L3,L4,M phase
  `}
/>

### 特性

| 属性 | 值 |
|----------|-------|
| **复杂度** | 高 |
| **产物** | 多角色分析文档 + `IMPL_PLAN.md` |
| **角色数量** | 3-9 (默认 3) |
| **执行模式** | 阶段 1/3 串行，阶段 2 并行 |

### 流程阶段

#### 阶段 1: 交互式框架生成

```bash
/workflow:brainstorm:artifacts "实时通知系统架构设计"
```

**步骤**:
1. **主题分析** - 分析主题，生成关键问题
2. **角色选择** - 用户确认角色选择
3. **角色问题分配** - 为角色分配问题
4. **冲突检测** - 检测并解决角色冲突
5. **生成框架** - 创建 `guidance-specification.md`

#### 阶段 2: 并行角色分析

```bash
# 并行执行 N 个 conceptual-planning-agent 任务
Task(subagent_type: "conceptual-planning-agent", prompt: "Role: {role}, Topic: {topic}, Questions: {questions}")
```

**每个角色**:
- 接收特定角色的指导
- 独立分析主题
- 生成 `{role}/analysis.md`
- 可选: 子文档 (最多 5 个)

#### 阶段 3: 综合整合

```bash
/workflow:brainstorm:synthesis --session {sessionId}
```

**步骤**:
1. **收集** 所有角色分析
2. **整合** 视角到综合文档
3. **生成** `synthesis-specification.md`
4. **识别** 关键决策和权衡点

### 可用角色

| 角色 | 描述 |
|------|-------------|
| `system-architect` | 系统架构师 - 整体系统设计 |
| `ui-designer` | UI 设计师 - 用户界面设计 |
| `ux-expert` | UX 专家 - 用户体验优化 |
| `product-manager` | 产品经理 - 产品需求 |
| `product-owner` | 产品负责人 - 业务价值 |
| `data-architect` | 数据架构师 - 数据结构设计 |
| `scrum-master` | Scrum 主管 - 流程和团队 |
| `subject-matter-expert` | 领域专家 - 专业领域知识 |
| `test-strategist` | 测试策略师 - 测试策略 |

### 产物结构

```
.workflow/active/WFS-realtime-notifications/
├── workflow-session.json
└── .brainstorming/
    ├── guidance-specification.md      # 框架 (阶段 1)
    ├── system-architect/
    │   ├── analysis.md                # 主文档
    │   └── analysis-scale-{}.md       # 子文档 (可选，最多 5 个)
    ├── ux-expert/
    │   ├── analysis.md
    │   └── analysis-accessibility.md
    ├── data-architect/
    │   ├── analysis.md
    │   └── analysis-storage.md
    └── synthesis-specification.md     # 整合 (阶段 3)
```

### 使用场景

#### 何时使用

- 新功能设计
- 系统架构重构
- 探索性需求
- 不确定的实现方案
- 需要多维度权衡分析

#### 何时不使用

- 需求明确 (使用层级 2-3)
- 时间敏感任务 (使用层级 2)
- 单一视角足够 (使用层级 2-3)

### 示例

#### 示例 1: 架构设计

```bash
/workflow:brainstorm:auto-parallel "电商平台微服务架构" --count 5
```

**角色**: system-architect, data-architect, ux-expert, product-manager, test-strategist

**输出**:
- 多个架构视角
- 数据流考虑
- 用户体验影响
- 业务需求对齐
- 测试策略建议

#### 示例 2: 功能探索

```bash
/workflow:brainstorm:auto-parallel "AI 驱动推荐系统" --count 3
```

**角色**: system-architect, product-manager, subject-matter-expert

**输出**:
- 技术可行性分析
- 业务价值评估
- 领域特定考量

## 文档化工作流 (With-File)

**文档化工作流** 提供带有多 CLI 协作的文档化探索。它们是自包含的，生成全面的会话产物。

| 工作流 | 用途 | 层级 | 主要特性 |
|----------|---------|-------|--------------|
| **brainstorm-with-file** | 多视角创意生成 | 4 | Gemini/Codex/Claude 视角，发散-收敛循环 |
| **debug-with-file** | 假设驱动调试 | 3 | Gemini 验证，理解演进，NDJSON 日志 |
| **analyze-with-file** | 协作分析 | 3 | 多轮问答，CLI 探索，文档化讨论 |

### brainstorm-with-file

**多视角创意生成与文档化探索**

```bash
/workflow:brainstorm-with-file "通知系统重新设计"
```

**输出目录**: `.workflow/.brainstorm/`

**特性**:
- 发散-收敛循环
- 多 CLI 视角 (Gemini, Codex, Claude)
- 内置完成后选项 (创建规划、问题、深度分析)

### debug-with-file

**假设驱动调试与文档化调查**

```bash
/workflow:debug-with-file "系统在负载下随机崩溃"
```

**输出目录**: `.workflow/.debug/`

**特性**:
- 假设驱动迭代
- Gemini 假设验证
- 理解演进跟踪
- NDJSON 日志用于可复现性

### analyze-with-file

**协作分析与文档化讨论**

```bash
/workflow:analyze-with-file "理解认证架构设计决策"
```

**输出目录**: `.workflow/.analysis/`

**特性**:
- 多轮问答
- CLI 探索集成
- 文档化讨论线程

## 检测关键词

| 工作流 | 关键词 |
|----------|----------|
| **brainstorm** | 头脑风暴, 创意, 发散思维, multi-perspective, compare perspectives, 探索可能 |
| **debug-file** | 深度调试, 假设验证, systematic debug, hypothesis debug, 调试记录 |
| **analyze-file** | 协作分析, 深度理解, collaborative analysis, explore concept, 理解架构 |

## 对比: 文档化 vs 标准工作流

| 方面 | 文档化工作流 | 标准工作流 |
|--------|---------------------|-------------------|
| **文档** | 演进式文档 | 会话产物 |
| **多 CLI** | 内置 (Gemini/Codex/Claude) | 可选 |
| **迭代** | 自包含循环 | 手动继续 |
| **完成后选项** | 内置选项 | 手动下一步 |
| **最适合** | 文档化探索 | 结构化执行 |

## 层级 4 总结

| 方面 | 值 |
|--------|-------|
| **复杂度** | 高 |
| **产物** | 多角色分析 + 会话 |
| **规划** | 多视角收敛 |
| **执行** | 标准层级 3 执行 |
| **最适合** | 复杂探索性任务 |

## 相关工作流

- [层级 3: 标准](./level-3-standard.mdx) - 标准规划工作流
- [层级 5: 智能](./level-5-intelligent.mdx) - 自动编排
- [FAQ](./faq.mdx) - 常见问题

## 命令参考

参见 [命令文档](../commands/general/ccw.mdx) 了解:
- `/workflow:brainstorm:auto-parallel` - 多角色头脑风暴
- `/workflow:brainstorm-with-file` - 文档化创意生成
- `/workflow:debug-with-file` - 假设驱动调试
- `/workflow:analyze-with-file` - 协作分析
