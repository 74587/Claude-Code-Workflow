---
name: auto-parallel
description: Parallel brainstorming automation with dynamic role selection and concurrent execution
argument-hint: "topic or challenge description" [--count N]
allowed-tools: SlashCommand(*), Task(*), TodoWrite(*), Read(*), Write(*), Bash(*), Glob(*)
---

# Workflow Brainstorm Parallel Auto Command

## Usage
```bash
/workflow:brainstorm:auto-parallel "<topic>" [--count N]
```

**Recommended Structured Format**:
```bash
/workflow:brainstorm:auto-parallel "GOAL: [objective] SCOPE: [boundaries] CONTEXT: [background]" [--count N]
```

**Parameters**:
- `topic` (required): Topic or challenge description (structured format recommended)
- `--count N` (optional): Number of roles to auto-select (default: 3, max: 9)

**⚠️ User Intent Preservation**: Topic description is stored in session metadata as authoritative reference throughout entire brainstorming workflow and plan generation.

## Role Selection Delegation
- **Role selection**: Fully delegated to artifacts command (intelligent recommendation + user selection)
- **Count parameter**: `--count N` passed to artifacts command (default: 3, max: 9)
- **Available roles**: Defined in artifacts command specification
- **Selection mechanism**: artifacts analyzes topic, recommends count+2 roles, user selects via multiSelect

**Template Loading**: Handled by individual role agents during parallel execution
**Template Source**: `.claude/workflows/cli-templates/planning-roles/`

## Core Workflow

### Structured Topic Processing → Role Analysis → Synthesis
The command follows a structured three-phase approach with dedicated document types:

**Phase 1: Interactive Framework Generation** ⚠️ COMMAND EXECUTION
- **Delegate to artifacts**: Execute `/workflow:brainstorm:artifacts "{topic}" --count N` using SlashCommand tool
- **Role selection**: artifacts command handles intelligent recommendation and user selection
- **Interactive flow**: artifacts executes Phase 1-5 (topic analysis, role recommendation, role questions, conflict resolution, guidance generation)
- **Output**: guidance-specification.md with confirmed decisions and selected_roles stored in session
- **⚠️ User intent storage**: Topic and all decisions saved in workflow-session.json as primary reference

**Phase 2: Role Analysis Execution** ⚠️ PARALLEL AGENT ANALYSIS
- **Parallel execution**: Multiple roles execute simultaneously for faster completion
- **Independent agents**: Each role gets dedicated conceptual-planning-agent running in parallel
- **Shared framework**: All roles reference the same topic framework for consistency
- **Concurrent generation**: Role-specific analysis documents generated simultaneously
- **Progress tracking**: Parallel agents update progress independently

**Phase 3: Synthesis Generation** ⚠️ COMMAND EXECUTION
- **Call synthesis command**: Execute `/workflow:brainstorm:synthesis` using SlashCommand tool
- **⚠️ User intent injection**: Synthesis loads original topic from session metadata as highest priority reference
- **Intent alignment**: Synthesis validates all role insights against user's original objectives

## Implementation Standards

### Simplified Command Orchestration ⚠️ STREAMLINED
Auto command coordinates independent specialized commands:

**Command Sequence**:
1. **Parse Parameters**: Extract --count N from user input (default: 3)
2. **Interactive Framework Generation**: Use SlashCommand to execute `/workflow:brainstorm:artifacts "{topic}" --count N`
   - artifacts handles: topic analysis, role recommendation, user selection, role questions, conflict resolution
   - Output: guidance-specification.md + session with selected_roles
3. **Load Selected Roles**: Read selected_roles from workflow-session.json (generated by artifacts)
4. **Parallel Role Analysis**: Execute selected role agents in parallel, each reading guidance-specification.md
5. **Generate Synthesis**: Use SlashCommand to execute `/workflow:brainstorm:synthesis`

**SlashCommand Integration**:
1. **artifacts command**: Called via SlashCommand tool with `--count N` parameter for interactive framework generation
2. **role agents**: Each agent reads guidance-specification.md for topic framework
3. **synthesis command**: Called via SlashCommand tool for final integration
4. **Command coordination**: SlashCommand handles execution and validation

### Parameter Parsing

**Count Parameter Handling**:
```bash
# Parse --count parameter from user input
IF user_input CONTAINS "--count":
    EXTRACT count_value FROM "--count N" pattern
    IF count_value > 9:
        count_value = 9  # Cap at maximum 9 roles
    END IF
ELSE:
    count_value = 3  # Default to 3 roles
END IF

# Pass to artifacts command
EXECUTE: /workflow:brainstorm:artifacts "{topic}" --count {count_value}
```

**Role Selection Mechanism** (delegated to artifacts):
1. **artifacts analyzes topic**: Extract keywords and challenges
2. **artifacts recommends roles**: Intelligent recommendation of count+2 roles
3. **User selects**: multiSelect from recommended roles
4. **Session stores**: selected_roles saved to workflow-session.json
5. **auto-parallel reads**: Load selected_roles for parallel execution

### Simplified Processing Standards

**Core Principles**:
1. **Minimal preprocessing** - Only workflow-session.json and basic role selection
2. **Agent autonomy** - Agents handle their own context and validation
3. **Parallel execution** - Multiple agents can work simultaneously
4. **Post-processing synthesis** - Integration happens after agent completion
5. **TodoWrite control** - Progress tracking throughout all phases

**Implementation Rules**:
- **Role count**: N roles selected interactively via artifacts command (default: 3, max: 9)
- **No upfront validation**: Agents handle their own context requirements
- **Parallel execution**: Each agent operates concurrently without dependencies
- **Synthesis at end**: Integration only after all agents complete

**Agent Self-Management** (Agents decide their own approach):
- **Context gathering**: Agents determine what questions to ask
- **Template usage**: Agents load and apply their own role templates
- **Analysis depth**: Agents determine appropriate level of detail
- **Documentation**: Agents create their own file structure and content

### Session Management ⚠️ CRITICAL
- **⚡ FIRST ACTION**: Check for all `.workflow/.active-*` markers before role processing
- **Multiple sessions support**: Different Claude instances can have different active brainstorming sessions
- **User selection**: If multiple active sessions found, prompt user to select which one to work with
- **Auto-session creation**: `WFS-[topic-slug]` only if no active session exists
- **Session continuity**: MUST use selected active session for all role processing
- **Context preservation**: Each role's context and agent output stored in session directory
- **Session isolation**: Each session maintains independent brainstorming state and role assignments

## Document Generation

**Command Coordination Workflow**:
1. artifacts (interactive: topic analysis → role selection → guidance generation)
2. parallel role analysis (agents read guidance-specification.md)
3. synthesis (integrates role analyses)

**Output Structure**:
- artifacts: guidance-specification.md (confirmed decisions + selected_roles)
- role agents: role-specific analysis.md files
- synthesis: synthesis-specification.md (integrated analysis)


## Agent Prompt Templates

### Task Agent Invocation Template


```python
Task(subagent_type="conceptual-planning-agent",
     prompt="""Execute brainstorming analysis: {role-name} perspective for {topic}

## Role Assignment
**ASSIGNED_ROLE**: {role-name}
**TOPIC**: {user-provided-topic}
**OUTPUT_LOCATION**: .workflow/WFS-{topic}/.brainstorming/{role}/

## Execution Instructions
[FLOW_CONTROL]

### Flow Control Steps
**AGENT RESPONSIBILITY**: Execute these pre_analysis steps sequentially with context accumulation:

1. **load_topic_framework**
   - Action: Load structured topic discussion framework
   - Command: Read(.workflow/WFS-{topic}/.brainstorming/guidance-specification.md)
   - Output: topic_framework
   - Fallback: Continue with session metadata if file not found

2. **load_role_template**
   - Action: Load {role-name} planning template
   - Command: Read(~/.claude/workflows/cli-templates/planning-roles/{role}.md)
   - Output: role_template

3. **load_session_metadata**
   - Action: Load session metadata and original user intent
   - Command: Read(.workflow/WFS-{topic}/workflow-session.json)
   - Output: session_metadata (contains original user prompt in 'project' or 'description' field)

### Implementation Context
**User Intent Authority**: Original user prompt from session_metadata.project is PRIMARY reference
**Topic Framework**: Use loaded guidance-specification.md for structured analysis
**Role Focus**: {role-name} domain expertise and perspective aligned with user intent
**Analysis Type**: Address framework discussion points from role perspective, filtered by user objectives
**Template Framework**: Combine role template with topic framework structure
**Structured Approach**: Create analysis.md addressing all topic framework points relevant to user's goals

### Session Context
**Workflow Directory**: .workflow/WFS-{topic}/.brainstorming/
**Output Directory**: .workflow/WFS-{topic}/.brainstorming/{role}/
**Session JSON**: .workflow/WFS-{topic}/workflow-session.json

### Dependencies & Context
**Topic**: {user-provided-topic}
**Role Template**: ~/.claude/workflows/cli-templates/planning-roles/{role}.md
**User Requirements**: To be gathered through interactive questioning

## Completion Requirements
1. Execute all flow control steps in sequence (load topic framework, role template, session metadata with user intent)
2. User Intent Alignment: Validate analysis aligns with original user objectives from session_metadata
3. Address Topic Framework: Respond to all discussion points in guidance-specification.md from role perspective
4. Filter by User Goals: Prioritize insights directly relevant to user's stated objectives
5. Apply role template guidelines within topic framework structure
6. Generate structured role analysis addressing framework points aligned with user intent
7. Create single comprehensive deliverable in OUTPUT_LOCATION:
   - analysis.md (structured analysis addressing all topic framework points with role-specific insights filtered by user goals)
8. Include framework reference: @../guidance-specification.md in analysis.md
9. Update workflow-session.json with completion status""",
     description="Execute {role-name} brainstorming analysis")
```

### Parallel Role Agent调用示例
```bash
# Execute N roles in parallel using single message with multiple Task calls
# (N determined by --count parameter, default 3, shown below with 3 roles as example)

Task(subagent_type="conceptual-planning-agent",
     prompt="Execute brainstorming analysis: {role-1} perspective for {topic}...",
     description="Execute {role-1} brainstorming analysis")

Task(subagent_type="conceptual-planning-agent",
     prompt="Execute brainstorming analysis: {role-2} perspective for {topic}...",
     description="Execute {role-2} brainstorming analysis")

Task(subagent_type="conceptual-planning-agent",
     prompt="Execute brainstorming analysis: {role-3} perspective for {topic}...",
     description="Execute {role-3} brainstorming analysis")

# ... repeat for remaining N-3 roles if --count > 3
```

### Direct Synthesis Process (Command-Driven)
**Synthesis execution**: Use SlashCommand to execute `/workflow:brainstorm:synthesis` after role completion


## TodoWrite Control Flow ⚠️ CRITICAL

### Workflow Progress Tracking
**MANDATORY**: Use Claude Code's built-in TodoWrite tool throughout entire brainstorming workflow:

```javascript
// Phase 1: Create initial todo list for command-coordinated brainstorming workflow
TodoWrite({
  todos: [
    {
      content: "Initialize brainstorming session and detect active sessions",
      status: "pending",
      activeForm: "Initializing brainstorming session"
    },
    {
      content: "Parse --count parameter from user input",
      status: "pending",
      activeForm: "Parsing count parameter"
    },
    {
      content: "Execute artifacts command for interactive framework generation (role selection + guidance)",
      status: "pending",
      activeForm: "Executing artifacts command for interactive framework"
    },
    {
      content: "Load selected_roles from workflow-session.json (generated by artifacts)",
      status: "pending",
      activeForm: "Loading selected roles from session"
    },
    {
      content: "Execute [role-1] analysis [conceptual-planning-agent] [FLOW_CONTROL] addressing framework",
      status: "pending",
      activeForm: "Executing [role-1] structured framework analysis"
    },
    {
      content: "Execute [role-2] analysis [conceptual-planning-agent] [FLOW_CONTROL] addressing framework",
      status: "pending",
      activeForm: "Executing [role-2] structured framework analysis"
    },
    // ... repeat for N roles (N determined by --count parameter, default 3)
    {
      content: "Execute [role-N] analysis [conceptual-planning-agent] [FLOW_CONTROL] addressing framework",
      status: "pending",
      activeForm: "Executing [role-N] structured framework analysis"
    },
    {
      content: "Execute synthesis command using SlashCommand for final integration",
      status: "pending",
      activeForm: "Executing synthesis command for integrated analysis"
    }
  ]
});

// Phase 2: Update status as workflow progresses - ONLY ONE task should be in_progress at a time
TodoWrite({
  todos: [
    {
      content: "Initialize brainstorming session and detect active sessions",
      status: "completed",
      activeForm: "Initializing brainstorming session"
    },
    {
      content: "Parse --count parameter from user input",
      status: "completed",
      activeForm: "Parsing count parameter"
    },
    {
      content: "Execute artifacts command for interactive framework generation (role selection + guidance)",
      status: "in_progress",
      activeForm: "Executing artifacts command for interactive framework"
    },
    // ... other tasks remain pending
  ]
});

// Phase 3: Parallel agent execution tracking (N roles, N from --count parameter)
TodoWrite({
  todos: [
    // ... previous completed tasks
    {
      content: "Execute [role-1] analysis [conceptual-planning-agent] [FLOW_CONTROL]",
      status: "in_progress",  // Executing in parallel
      activeForm: "Executing [role-1] brainstorming analysis"
    },
    {
      content: "Execute [role-2] analysis [conceptual-planning-agent] [FLOW_CONTROL]",
      status: "in_progress",  // Executing in parallel
      activeForm: "Executing [role-2] brainstorming analysis"
    },
    // ... repeat for remaining N-2 roles
    {
      content: "Execute [role-N] analysis [conceptual-planning-agent] [FLOW_CONTROL]",
      status: "in_progress",  // Executing in parallel
      activeForm: "Executing [role-N] brainstorming analysis"
    }
  ]
});
```

**TodoWrite Integration Rules**:
1. **Create initial todos**: All workflow phases at start
2. **Mark in_progress**: Multiple parallel tasks can be in_progress simultaneously
3. **Update immediately**: After each task completion
4. **Track agent execution**: Include [agent-type] and [FLOW_CONTROL] markers for parallel agents
5. **Final synthesis**: Mark synthesis as in_progress only after all parallel agents complete

## Reference Information

### Structured Processing Schema
Each role processing follows structured framework pattern:
- **topic_framework**: Structured discussion framework document
- **role**: Selected planning role name with framework reference
- **agent**: Dedicated conceptual-planning-agent instance
- **structured_analysis**: Agent addresses all framework discussion points
- **output**: Role-specific analysis.md addressing topic framework structure

### File Structure Reference
**Architecture**: ~/.claude/workflows/workflow-architecture.md
**Role Templates**: ~/.claude/workflows/cli-templates/planning-roles/

### Execution Integration
Command coordination model: artifacts command → parallel role analysis → synthesis command


## Error Handling
- **Role selection failure**: Default to `product-manager` with explanation
- **Agent execution failure**: Agent-specific retry with minimal dependencies
- **Template loading issues**: Agent handles graceful degradation
- **Synthesis conflicts**: Synthesis agent highlights disagreements without resolution

## Quality Standards

### Agent Autonomy Excellence
- **Single role focus**: Each agent handles exactly one role independently
- **Self-contained execution**: Agent manages own context, validation, and output
- **Parallel processing**: Multiple agents can execute simultaneously
- **Complete ownership**: Agent produces entire role-specific analysis package

### Minimal Coordination Excellence
- **Lightweight handoff**: Only topic and role assignment provided
- **Agent self-management**: Agents handle their own workflow and validation
- **Concurrent operation**: No inter-agent dependencies enabling parallel execution
- **Reference-based synthesis**: Post-processing integration without content duplication
- **TodoWrite orchestration**: Progress tracking and workflow control throughout entire process
